<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>AI对话助手</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <link rel="manifest" href="manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
</head>
<body>
    <div class="app-container">
        <!-- 侧边栏 -->
        <div class="sidebar">
            <div class="sidebar-header">
                <h3>对话助手</h3>
                <button id="newChatBtn" title="新建对话"><i class="fas fa-plus"></i> 新对话</button>
            </div>
            <div class="history-list" id="historyList">
                <!-- 历史记录将在JS中动态添加 -->
            </div>
            <div class="sidebar-footer">
                <button id="exportHistoryBtn" title="导出所有对话"><i class="fas fa-download"></i> 导出对话</button>
                <button id="importHistoryBtn" title="导入对话"><i class="fas fa-upload"></i> 导入对话</button>
            </div>
        </div>

        <!-- 主内容区 -->
        <div class="main-content">
            <!-- 顶部控制栏 -->
            <div class="control-bar">
                <div class="menu-toggle">
                    <button id="menuToggleBtn" title="菜单"><i class="fas fa-bars"></i></button>
                </div>
                <div class="model-selector">
                    <span class="mode-indicator" id="modeIndicator" title="当前模式">
                        <i class="fas fa-robot"></i>
                        <span id="modeText">单AI模式</span>
                    </span>
                </div>
                <div class="api-selector">
                    <button id="settingsBtn" title="API设置"><i class="fas fa-cog"></i></button>
                </div>
            </div>

            <!-- 对话区域 -->
            <div class="chat-container">
                <div id="chatbox">
                    <div class="welcome-message">
                        <h2>欢迎使用AI对话助手</h2>
                        <p>请先在设置中输入API密钥以开始对话</p>
                        <button id="openSettingsBtn">打开设置</button>
                    </div>
                </div>
                
                <!-- 输入区域 -->
                <div class="input-area">
                    <textarea id="userInput" placeholder="输入消息..." rows="1"></textarea>
                    <button id="sendBtn" title="发送"><i class="fas fa-paper-plane"></i></button>
                </div>
            </div>
        </div>
    </div>

    <!-- 设置弹窗 -->
    <div id="settingsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>API设置</h3>
                <span class="close-modal">&times;</span>
            </div>
            <div class="modal-body">
                <div class="form-group api-row">
                    <div class="api-provider-group">
                        <label for="apiProvider">API提供商</label>
                        <select id="apiProvider">
                            <option value="deepseek">DeepSeek</option>
                            <option value="openai">OpenAI</option>
                        </select>
                    </div>
                    <div class="api-key-group">
                        <label for="apiKey">API密钥</label>
                        <input type="password" id="apiKey" placeholder="输入您的API密钥" value="" />
                    </div>
                </div>
                <div class="form-group">
                    <small class="help-text">您的API密钥仅存储在本地浏览器中，不会上传到任何服务器</small>
                </div>
                <div class="form-group nickname-row">
                    <div class="nickname-group">
                        <label for="historyLimit">保留对话轮数</label>
                        <input type="number" id="historyLimit" min="1" max="50" placeholder="默认保留最近10轮对话" />
                        <small class="help-text">设置保留的最近对话轮数（1-50）</small>
                    </div>
                    <div class="nickname-group">
                        <label for="userName">您的昵称</label>
                        <input type="text" id="userName" placeholder="显示在您的消息上的名称" />
                    </div>
                </div>
                <div class="form-group">
                    <label for="systemPrompt">系统提示词</label>
                    <textarea id="systemPrompt" placeholder="自定义系统提示词，指导AI如何回答" rows="4"></textarea>
                    <small class="help-text">系统提示词可以指导AI的回答风格和内容</small>
                </div>
                <div class="form-group">
                    <label class="checkbox-label">
                        <input type="checkbox" id="enableLogging" />
                        <span class="checkmark"></span>
                        启用输出日志
                    </label>
                    <small class="help-text">勾选后将记录并保存所有传输给LLM模型的内容，包括系统提示词、用户输入和AI回复</small>
                </div>
                <div class="form-group log-management" id="logManagementSection" style="display: none;">
                    <div class="log-buttons">
                        <button type="button" id="exportLogsBtn" class="log-btn">导出日志</button>
                        <button type="button" id="clearLogsBtn" class="log-btn">清空日志</button>
                        <span class="log-info" id="logInfo"></span>
                    </div>
                </div>
                <hr class="settings-divider">
                <div class="role-settings-header">
                    <h4 class="settings-subtitle">角色设置</h4>
                    <button id="addRoleBtn" class="add-role-btn">
                        <i class="fas fa-plus"></i> 添加角色
                    </button>
                </div>
                
                <!-- 多AI发言模式设置 -->
                <div class="form-group" id="multiAISettings" style="display: none;">
                    <label for="speakMode">多AI发言模式</label>
                    <select id="speakMode">
                        <option value="sequential">依次发言</option>
                        <option value="simultaneous">同时发言</option>
                    </select>
                    <small class="help-text">
                        <strong>依次发言</strong>：AI轮流回复，每个AI都能看到之前所有AI的回复<br>
                        <strong>同时发言</strong>：两个AI同时收到用户输入，第二轮时用户输入+另一个AI的输出作为新的用户输入
                    </small>
                </div>
                
                <div id="rolesContainer">
                    <!-- 角色列表将在这里动态生成 -->
                </div>


            </div>
            <div class="modal-footer">
                <button id="cancelSettingsBtn">取消</button>
                <button id="saveSettingsBtn">保存设置</button>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>